<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragment/default}">
<head>
    <th:block layout:fragment="css">
        <link rel="stylesheet" href="/css/shop/designerProfile.css">
    </th:block>
</head>
<body>
<div layout:fragment="main" id="main">

    <!-- 디자이너 프로필 섹션 -->
    <section class="designer-profile-top">
        <div class="container">
            <div class="designer-profile-box">
                <div class="designer-photo-wrapper">
                    <img class="designer-photo" th:src="${dto?.designerImgUrl ?: '/images/default.png'}" alt="프로필사진" />
                </div>

                <div class="designer-content-wrapper">
                    <div class="designer-info">
                        <h2 class="designer-name" th:text="${dto?.designerName ?: '이름 없음'}">디자이너 이름</h2>
                        <p class="designer-subinfo" th:text="${dto?.expertise ?: '전문분야 없음'}">전문분야</p>
                        <div class="designer-salon">
                            <i class="fa-solid fa-scissors"></i>
                            <span th:text="${dto?.salonName ?: '@소속 미용실'}">@Salon</span>
                        </div>
                        <p class="off-day" th:text="|\ud83d\uddd3\ufe0f 휴무일 : ${dto?.offDays ?: '정보 없음'}|">휴무일</p>
                        <button class="toggle-description">더보기 <i class="fa-solid fa-chevron-down"></i></button>
                    </div>

                    <div class="designer-description">
                        <p th:text="${dto?.description ?: '소개글이 없습니다.'}">소개글</p>
                    </div>

                    <div class="profile-actions">
                        <button class="icon-text-btn">
                            <svg ... class="lucide lucide-heart">...</svg>
                            찜하기
                        </button>
                        <button class="icon-text-btn">
                            <svg ... class="lucide lucide-share-2">...</svg>
                            공유
                        </button>
                        <div id="share-modal" style="display: none">
                            <div class="modal-content">
                                <p>공유할 수 있는 링크 복사하기</p>
                                <input type="text" th:value="${dto?.shareLink ?: 'localhost/designerPorfile/@{designerId}'}" readonly />
                                <button>복사</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 메뉴바 -->
    <section class="designer-tabs">
        <div class="container">
            <nav class="designer-tabs-menu">
                <ul>
                    <li class="tab-item active" data-tab="tab-home">홈</li>
                    <li class="tab-item" data-tab="tab-menu">메뉴</li>
                    <li class="tab-item" data-tab="tab-review">리뷰</li>
                </ul>
            </nav>
        </div>
    </section>

    <!-- 시술 카테고리 탭 -->
    <section class="category-tabs-wrapper" id="categoryTabs" style="display: none">
        <div class="category-tabs">
            <button class="category-btn active" data-category="cut">커트</button>
            <button class="category-btn" data-category="perm-w">여성펌</button>
            <button class="category-btn" data-category="perm-m">남성펌</button>
            <button class="category-btn" data-category="clinic">클리닉</button>
            <button class="category-btn" data-category="style">스타일링</button>
        </div>
    </section>

    <!-- 메뉴 탭 콘텐츠: 홈 -->
    <section class="tab-content" id="tab-home" style="display: block">
        <div class="container">
            <h3 th:text="|${dto?.designerName ?: '디자이너'}의 시술 미리보기|">시술 미리보기</h3>
            <ul class="service-list">
                <li class="service-item" th:each="service : ${dto?.previewServices}">
                    <div class="service-img">
                        <img th:src="${service.imgUrl ?: '/images/placeholder.png'}" alt="시술사진" />
                    </div>
                    <div class="service-info">
                        <strong class="service-name" th:text="${service.name ?: '이름 없음'}">시술명</strong>
                        <div class="service-price">
                            <span class="discount" th:if="${service.discountPercent > 0}" th:text="|${service.discountPercent}%|">할인율</span>
                            <span class="original" th:text="|${#numbers.formatInteger(service.price, 3, 'COMMA')}원|">정가</span>
                            <span class="final" th:if="${service.discountPercent > 0}" th:text="|${#numbers.formatInteger(service.finalPrice, 3, 'COMMA')}원|">할인가</span>
                        </div>
                        <div class="service-extra" th:text="${service.extraInfo ?: ''}">추가정보</div>
                    </div>
                </li>
            </ul>
        </div>

        <!-- 리뷰 요약 -->
        <div class="designer-review-section">
            <div class="review-container">
                <h3 class="review-title">리뷰 | <span th:text="${dto?.reviewCount ?: 0}">0</span></h3>
                <div class="review-thumbnails" th:if="${dto?.thumbnailDtos != null}">
                    <div class="thumbnail" th:each="img, iter : ${dto.thumbnailDtos}" th:if="${iter.count <= 7}" th:remove="tag">
                        <img th:src="${img.imgUrl ?: '/images/placeholder.png'}" alt="리뷰이미지" />
                    </div>
                    <div class="thumbnail last" th:if="${dto.thumbnailDtos.size() >= 8}">
                        <img th:src="${dto.thumbnailDtos[7].imgUrl ?: '/images/placeholder.png'}" alt="추가 이미지" />
                        <span class="plus">+</span>
                    </div>
                </div>

                <ul class="review-list">
                    <li class="review-item" th:each="review : ${dto?.reviewListDtos}">
                        <div class="review-header">
                            <strong th:text="${review.serviceName ?: '시술명 없음'}"></strong><span class="chevron">&gt;</span>
                        </div>
                        <div class="review-rating" th:text="${review.rating != null ? review.rating + '점' : '평점 없음'}"></div>
                        <div class="review-content">
                            <p th:text="${review.reviewText ?: '리뷰 없음'}">리뷰내용</p>
                            <div class="review-meta" th:text="|${review.memberName ?: '익명'} · ${#temporals.format(review.createdAt ?: @java.time.LocalDate.now(), 'yyyy.MM.dd')} · ${(review.visitCount != null ? review.visitCount + '번째 방문' : '')}|">
                                작성자 · 날짜 · 방문횟수
                            </div>
                        </div>
                        <div class="r-reply" th:if="${review.replyDto != null}">
                            <strong>디자이너 답글</strong>
                            <p th:text="${review.replyDto.replyComment ?: '답글 없음'}">답글 내용</p>
                            <div class="r-meta" th:text="${#temporals.format(review.replyDto.replyAt ?: @java.time.LocalDate.now(), 'yyyy.MM.dd')}">답글 날짜</div>
                        </div>
                    </li>
                </ul>

                <div class="review-more">
                    <button class="reviewmore-btn">더보기</button>
                </div>
            </div>
        </div>
    </section>

    <!-- 메뉴 탭 콘텐츠: 메뉴 -->
    <section class="tab-content" id="tab-menu" style="display: none">
        <div class="container">
            <th:block th:each="entry : ${dto?.serviceMap}">
                <h3 th:text="${entry.key == 'RECOMMENED' ? '추천 시술' : entry.key.label}">카테고리명</h3>
                <ul>
                    <li th:each="service : ${entry.value}">
                        <span th:text="${service.name ?: '이름 없음'}"></span>
                        <span th:if="${service.discountPercent > 0}">
                            <span th:text="|${service.discountPercent}%|"></span>
                            <span class="original" th:text="|${#numbers.formatInteger(service.price, 3, 'COMMA')}원|"></span>
                            <span class="final" th:text="|${#numbers.formatInteger(service.finalPrice, 3, 'COMMA')}원|"></span>
                        </span>
                        <span th:if="${service.discountPercent == 0}" th:text="|${#numbers.formatInteger(service.price, 3, 'COMMA')}원|">정가</span>
                    </li>
                </ul>
            </th:block>
        </div>
    </section>
</div>

<th:block layout:fragment="script">
    <script th:src="@{/javascript/shop/designerProfile.js}" defer></script>
</th:block>
</body>
</html>
