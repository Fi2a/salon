<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragment/default}">
<head>
    <th:block layout:fragment="css">
        <link rel="stylesheet" href="/css/announcement.css" />
    </th:block>
</head>
<body>
<div layout:fragment="main" id="main">
    <h1>공지사항</h1>

    <label><input type="radio" name="role" value="USER" checked onchange="filter()"/>회원</label>
    <label><input type="radio" name="role" value="DESIGNER" onchange="filter()" />디자이너</label>

    <br/>

    <input type="text" name="search" id="search" placeholder="제목 또는 내용을 검색하세요"/>
    <button onclick="filter()">검색</button>

    <table>
        <thead>
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>업로드 날짜</th>
            <th>첨부파일</th>
        </tr>
        </thead>
        <tbody id="noticeTable">
        <tr th:each="ancList : ${ancListDto}" th:data-role="${ancList.roleName}">
            <td th:text="${ancList.id}"></td>
            <td><a th:href="@{/admin/anc/detail(id=${ancList.id})}" th:text="${ancList.content}"></a></td>
            <td th:text="${ancList.writeAt}"></td>
            <td></td>
        </tr>
        </tbody>
    </table>
    <a href="/admin/anc/create" id="button">
        <button>공지 작성</button>
    </a>
</div>
<th:block layout:fragment="script">
    <script>
        const role = "회원";

        function filter() {
            const keyword = document.getElementById("search").value.trim();
            const selectRole = document.querySelector('input[name="role"]:checked').value;
            const rows = document.querySelectorAll("#noticeTable tr");

        rows.forEach((row) => {
            const role = (row.dataset.role || "").trim();
            const title = row.children[1].textContent || "";

            const roleMatches = role === selectRole;
            const keywordMatches = title.includes(keyword);

            console.log("role:", role, "| selected:", selectRole, "| match:", roleMatches);

            row.style.display = roleMatches && keywordMatches ? "" : "none";
        });
    }

    window.onload = filter;
    </script>
</th:block>
</body>
</html>